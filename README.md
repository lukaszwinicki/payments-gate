# Payments Gate

## ğŸ“ Overview

Payments Gate is a robust and secure payment gateway solution designed to facilitate seamless online transactions. It provides APIs  for integrating payment processing into your applications or websites.


## ğŸ“‘ Table of Contents

- [ğŸ“ Overview](#overview)
- [âœ¨ Features](#features)
- [ğŸ› ï¸ Technology Stack](#technology-stack)
- [ğŸ“š API Documentation](#api-documentation)
- [ğŸš€ Live Demo](#live-demo)
- [ğŸ”Œ Payment Processor Integration](#payment-processor-integration)
- [ğŸ’³ Integrated Payment Providers](#integrated-payment-providers)
- [ğŸ” API Authentication](#api-authentication)
- [ğŸ”” Webhook Mechanism](#webhook-mechanism)
- [ğŸ Getting Started](#getting-started)
- [ğŸ“„ License](#license)

## âœ¨ Features


- Secure payment processing
- RESTful API for easy integration
- Transaction history and reporting
- Webhook support for real-time notifications
- Detailed logging and error handling
- Modular integration of payment processors via dedicated service classes

  
## ğŸ› ï¸ Technology Stack


- **Framework:** Laravel 12
- **Authentication:** Laravel Breeze
- **Authorization:** Laravel Permission
- **Admin and User Panel:** Filament
- **Database:** PostgreSQL / MySQL
- **API:** RESTful, JSON-based


## ğŸ“š API Documentation

Comprehensive API documentation is available online. Visit the following link to explore available endpoints, request/response formats, and integration guides:

ğŸ‘‰ [API Documentation](https://payments-gate.onrender.com/api/documentation)



## ğŸš€ Live Demo

ğŸ‘‰ [Click here to view the live application](https://payments-gate.onrender.com)



## ğŸ”Œ Payment Processor Integration

Payments Gate supports seamless integration with multiple payment processors: **TPay**, **Paynow**, and **Noda**. Each processor is implemented as a dedicated service that adheres to a shared `PaymentMethodInterface`, enabling unified handling of transaction logic (create, confirm, refund) across providers.

``` php
interface PaymentMethodInterface
{
    public function create(array $transactionBody): ?CreateTransactionDto;
    public function confirm(array $webHookBody, array $headers): ?ConfirmTransactionDto;
    public function refund(array $refundBody): ?RefundPaymentDto;
}
```

## ğŸ§© Architecture Overview

The integration uses the **Factory Pattern** to dynamically resolve the appropriate payment provider service based on the selected payment method:

```php
public static function getInstanceByPaymentMethod(?PaymentMethod $paymentMethod): PaymentMethodInterface
{
    return match ($paymentMethod) {
        PaymentMethod::PAYMENT_METHOD_TPAY => App::make(TPayService::class),
        PaymentMethod::PAYMENT_METHOD_PAYNOW => App::make(PaynowService::class),
        PaymentMethod::PAYMENT_METHOD_NODA => App::make(NodaService::class),
        default => throw new NotImplementedException("Payment method " . ($paymentMethod) . " is not implemented.")
    };
}
```
### âš™ï¸ Payment Processing & Webhook Notifications

![Architecture Diagram](https://i.imgur.com/y9qFipo.png)


## ğŸ’³ Integrated Payment Providers

Payments Gate integrates with three major payment providers. Below is a brief overview and links to their official documentation for deeper integration details.

### ğŸ”¹ TPay

TPay is one of the most established payment service providers in Poland, supporting dozens of banks, card payments, and online transfers.

- ğŸ”— API Docs: [https://openapi.sandbox.tpay.com/](https://openapi.sandbox.tpay.com/)
---

### ğŸ”¹ Paynow

Paynow is a Polish online payment system that supports fast payments via bank transfers, BLIK, and cards. It is widely used in e-commerce and provides a clean REST API.

- ğŸ”— API Docs: [https://docs.paynow.pl/pl/docs/v3/integration](https://docs.paynow.pl/pl/docs/v3/integration)
---

### ğŸ”¹ Noda

Noda is a modern Open Banking payment gateway that enables direct bank payments via PSD2 APIs across Europe.

- ğŸ”— API Docs: [https://docs.noda.live/reference/introduction](https://docs.noda.live/reference/introduction)
---

Each of these operators has been integrated into **Payments Gate** to provide users with diverse and convenient payment options.

## Authentication â€“ API Key & Secret Key

To access and use the **Payments Gate API**, clients must authenticate using an API Key and Secret Key, which are generated by the system during account or application registration.

### ğŸ” How Authentication Works

- Upon registration, each client receives:
  - **API Key** â€“ public identifier used to make requests
  - **Secret Key** â€“ private credential used to sign requests

- These credentials are required for every request to protected endpoints.


### ğŸ”§ Getting Your Keys

1. Register or log into your account on the Payments Gate dashboard.
2. Navigate to **Profiles -> Access Keys**.
3. View your:
   - `API_KEY`
   - `SECRET_KEY`

You should store these securely and never expose your Secret Key publicly.

### ğŸ“¡ Making Authenticated Requests

All requests to the Payments Gate API must include:

- `Headers: x-api-keys : <API_KEY>`

### ğŸ” Retry Policy

If a webhook fails to deliver (i.e., the HTTP response code is not `200`), the system will retry sending it **every 1 minute**, for up to **10 attempts**.

After **10 unsuccessful attempts**, the webhook will **no longer be retried**.

## ğŸ”” Webhook Mechanism

Our system supports webhook notifications that allow clients to automatically receive updates about the status of their transactions.

### ğŸ“Œ When are webhooks triggered?

A webhook is automatically sent in the following scenarios:

- âœ… When a transaction status changes (e.g., `SUCCESS`, `FAIL`, `REFUND_SUCCESS`, etc.).
- ğŸ”„ For refund transactions (`REFUND_PENDING`, `REFUND_SUCCESS`, `REFUND_FAIL`), after polling the status from an external service (e.g., Paynow).
- ğŸš¨ If a previous webhook delivery attempt failed, retries will be attempted every minute, up to **10 times**.

### ğŸ§¾ Webhook Payload

The webhook is sent as a `POST` request to the `notification_url` associated with the transaction.

#### Example JSON payload:

```json
{
  "signature": "fa7c8e27b6f3...",
  "transaction_uuid": "abcd-1234-efgh-5678",
  "amount": 199.99,
  "name": "John Doe",
  "email": "john@example.com",
  "currency": "PLN",
  "status": "SUCCESS",
  "payment_method": "TPAY"
}
```

## ğŸ” Webhook Signature Verification

Payments Gate sends webhook notifications to your backend when the transaction status changes. To ensure authenticity, each request includes a `signature` field â€“ an HMAC-SHA256 hash created using your **Secret Key**.

### âœ… How the Signature Is Generated

The signature is calculated on the server side as follows:

```php
$status = 'SUCCESS';
$transaction_uuid = 'abc-123-xyz';
$merchantSecretKey = 'your-merchant-secret-key';

$signature = hash_hmac('sha256', $status . $transaction_uuid, $merchantSecretKey);
```

## ğŸ Getting Started

1. **Clone the repository:**
  ```bash
  git clone https://github.com/lukaszwinicki/payments-gate
  cd payments-gate
  ```

2. **Install dependencies:**
  ```bash
  composer install
  npm install
  ```

3. **Set up environment:**
  - Copy `.env.example` to `.env` and configure your environment variables.

4. **Generate application key:**
  ```bash
  php artisan key:generate
  ```
   
5. **Run migrations:**
  ```bash
  php artisan migrate
  ```

6. **Start the development server:**
  ```bash
  php artisan serve
  ```

## ğŸ“„ License

This project is licensed under the MIT License.